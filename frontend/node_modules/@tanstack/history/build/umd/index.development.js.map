{"version":3,"file":"index.development.js","sources":["../../src/index.ts"],"sourcesContent":["// While the public API was clearly inspired by the \"history\" npm package,\n// This implementation attempts to be more lightweight by\n// making assumptions about the way TanStack Router works\n\nexport interface RouterHistory {\n  location: HistoryLocation\n  subscribe: (cb: () => void) => () => void\n  push: (path: string, state?: any) => void\n  replace: (path: string, state?: any) => void\n  go: (index: number) => void\n  back: () => void\n  forward: () => void\n  createHref: (href: string) => string\n  block: (blocker: BlockerFn) => () => void\n  flush: () => void\n  destroy: () => void\n  notify: () => void\n}\n\nexport interface HistoryLocation extends ParsedPath {\n  state: HistoryState\n}\n\nexport interface ParsedPath {\n  href: string\n  pathname: string\n  search: string\n  hash: string\n}\n\nexport interface HistoryState {\n  key: string\n}\n\ntype ShouldAllowNavigation = any\n\nexport type BlockerFn = () =>\n  | Promise<ShouldAllowNavigation>\n  | ShouldAllowNavigation\n\nconst pushStateEvent = 'pushstate'\nconst popStateEvent = 'popstate'\nconst beforeUnloadEvent = 'beforeunload'\n\nconst beforeUnloadListener = (event: Event) => {\n  event.preventDefault()\n  // @ts-ignore\n  return (event.returnValue = '')\n}\n\nconst stopBlocking = () => {\n  removeEventListener(beforeUnloadEvent, beforeUnloadListener, {\n    capture: true,\n  })\n}\n\nexport function createHistory(opts: {\n  getLocation: () => HistoryLocation\n  pushState: (path: string, state: any, onUpdate: () => void) => void\n  replaceState: (path: string, state: any, onUpdate: () => void) => void\n  go: (n: number) => void\n  back: () => void\n  forward: () => void\n  createHref: (path: string) => string\n  flush?: () => void\n  destroy?: () => void\n  onBlocked?: (onUpdate: () => void) => void\n}): RouterHistory {\n  let location = opts.getLocation()\n  let subscribers = new Set<() => void>()\n  let blockers: BlockerFn[] = []\n\n  const onUpdate = () => {\n    location = opts.getLocation()\n    subscribers.forEach((subscriber) => subscriber())\n  }\n\n  const tryNavigation = async (task: () => void) => {\n    if (typeof document !== 'undefined' && blockers.length) {\n      for (let blocker of blockers) {\n        const allowed = await blocker()\n        if (!allowed) {\n          opts.onBlocked?.(onUpdate)\n          return\n        }\n      }\n    }\n\n    task()\n  }\n\n  return {\n    get location() {\n      return location\n    },\n    subscribe: (cb: () => void) => {\n      subscribers.add(cb)\n\n      return () => {\n        subscribers.delete(cb)\n      }\n    },\n    push: (path: string, state: any) => {\n      state = assignKey(state)\n      tryNavigation(() => {\n        opts.pushState(path, state, onUpdate)\n      })\n    },\n    replace: (path: string, state: any) => {\n      state = assignKey(state)\n      tryNavigation(() => {\n        opts.replaceState(path, state, onUpdate)\n      })\n    },\n    go: (index) => {\n      tryNavigation(() => {\n        opts.go(index)\n      })\n    },\n    back: () => {\n      tryNavigation(() => {\n        opts.back()\n      })\n    },\n    forward: () => {\n      tryNavigation(() => {\n        opts.forward()\n      })\n    },\n    createHref: (str) => opts.createHref(str),\n    block: (blocker) => {\n      blockers.push(blocker)\n\n      if (blockers.length === 1) {\n        addEventListener(beforeUnloadEvent, beforeUnloadListener, {\n          capture: true,\n        })\n      }\n\n      return () => {\n        blockers = blockers.filter((b) => b !== blocker)\n\n        if (!blockers.length) {\n          stopBlocking()\n        }\n      }\n    },\n    flush: () => opts.flush?.(),\n    destroy: () => opts.destroy?.(),\n    notify: onUpdate,\n  }\n}\n\nfunction assignKey(state: HistoryState) {\n  if (!state) {\n    state = {} as HistoryState\n  }\n  return {\n    ...state,\n    key: createRandomKey(),\n  }\n}\n\n/**\n * Creates a history object that can be used to interact with the browser's\n * navigation. This is a lightweight API wrapping the browser's native methods.\n * It is designed to work with TanStack Router, but could be used as a standalone API as well.\n * IMPORTANT: This API implements history throttling via a microtask to prevent\n * excessive calls to the history API. In some browsers, calling history.pushState or\n * history.replaceState in quick succession can cause the browser to ignore subsequent\n * calls. This API smooths out those differences and ensures that your application\n * state will *eventually* match the browser state. In most cases, this is not a problem,\n * but if you need to ensure that the browser state is up to date, you can use the\n * `history.flush` method to immediately flush all pending state changes to the browser URL.\n * @param opts\n * @param opts.getHref A function that returns the current href (path + search + hash)\n * @param opts.createHref A function that takes a path and returns a href (path + search + hash)\n * @returns A history instance\n */\nexport function createBrowserHistory(opts?: {\n  parseLocation?: () => HistoryLocation\n  createHref?: (path: string) => string\n  window?: any\n}): RouterHistory {\n  const win =\n    opts?.window ??\n    (typeof document !== 'undefined' ? window : (undefined as any))\n\n  const createHref = opts?.createHref ?? ((path) => path)\n  const parseLocation =\n    opts?.parseLocation ??\n    (() =>\n      parseHref(\n        `${win.location.pathname}${win.location.search}${win.location.hash}`,\n        win.history.state,\n      ))\n\n  let currentLocation = parseLocation()\n  let rollbackLocation: HistoryLocation | undefined\n\n  const getLocation = () => currentLocation\n\n  let next:\n    | undefined\n    | {\n        // This is the latest location that we were attempting to push/replace\n        href: string\n        // This is the latest state that we were attempting to push/replace\n        state: any\n        // This is the latest type that we were attempting to push/replace\n        isPush: boolean\n      }\n\n  // Because we are proactively updating the location\n  // in memory before actually updating the browser history,\n  // we need to track when we are doing this so we don't\n  // notify subscribers twice on the last update.\n  let tracking = true\n\n  // We need to track the current scheduled update to prevent\n  // multiple updates from being scheduled at the same time.\n  let scheduled: Promise<void> | undefined\n\n  // This function is a wrapper to prevent any of the callback's\n  // side effects from causing a subscriber notification\n  const untrack = (fn: () => void) => {\n    tracking = false\n    fn()\n    tracking = true\n  }\n\n  // This function flushes the next update to the browser history\n  const flush = () => {\n    // Do not notify subscribers about this push/replace call\n    untrack(() => {\n      if (!next) return\n      win.history[next.isPush ? 'pushState' : 'replaceState'](\n        next.state,\n        '',\n        next.href,\n      )\n      // Reset the nextIsPush flag and clear the scheduled update\n      next = undefined\n      scheduled = undefined\n      rollbackLocation = undefined\n    })\n  }\n\n  // This function queues up a call to update the browser history\n  const queueHistoryAction = (\n    type: 'push' | 'replace',\n    destHref: string,\n    state: any,\n    onUpdate: () => void,\n  ) => {\n    const href = createHref(destHref)\n\n    if (!scheduled) {\n      rollbackLocation = currentLocation\n    }\n\n    // Update the location in memory\n    currentLocation = parseHref(destHref, state)\n\n    // Keep track of the next location we need to flush to the URL\n    next = {\n      href,\n      state,\n      isPush: next?.isPush || type === 'push',\n    }\n\n    // Notify subscribers\n    onUpdate()\n\n    if (!scheduled) {\n      // Schedule an update to the browser history\n      scheduled = Promise.resolve().then(() => flush())\n    }\n  }\n\n  const onPushPop = () => {\n    currentLocation = parseLocation()\n    history.notify()\n  }\n\n  var originalPushState = win.history.pushState\n  var originalReplaceState = win.history.replaceState\n\n  const history = createHistory({\n    getLocation,\n    pushState: (href, state, onUpdate) =>\n      queueHistoryAction('push', href, state, onUpdate),\n    replaceState: (href, state, onUpdate) =>\n      queueHistoryAction('replace', href, state, onUpdate),\n    back: () => win.history.back(),\n    forward: () => win.history.forward(),\n    go: (n) => win.history.go(n),\n    createHref: (href) => createHref(href),\n    flush,\n    destroy: () => {\n      win.history.pushState = originalPushState\n      win.history.replaceState = originalReplaceState\n      win.removeEventListener(pushStateEvent, onPushPop)\n      win.removeEventListener(popStateEvent, onPushPop)\n    },\n    onBlocked: (onUpdate) => {\n      // If a navigation is blocked, we need to rollback the location\n      // that we optimistically updated in memory.\n      if (rollbackLocation && currentLocation !== rollbackLocation) {\n        currentLocation = rollbackLocation\n        // Notify subscribers\n        onUpdate()\n      }\n    },\n  })\n\n  win.addEventListener(pushStateEvent, onPushPop)\n  win.addEventListener(popStateEvent, onPushPop)\n\n  win.history.pushState = function () {\n    let res = originalPushState.apply(win.history, arguments as any)\n    if (tracking) history.notify()\n    return res\n  }\n\n  win.history.replaceState = function () {\n    let res = originalReplaceState.apply(win.history, arguments as any)\n    if (tracking) history.notify()\n    return res\n  }\n\n  return history\n}\n\nexport function createHashHistory(opts?: { window?: any }): RouterHistory {\n  const win =\n    opts?.window ??\n    (typeof document !== 'undefined' ? window : (undefined as any))\n  return createBrowserHistory({\n    window: win,\n    parseLocation: () => {\n      const hashHref = win.location.hash.split('#').slice(1).join('#') ?? '/'\n      return parseHref(hashHref, win.history.state)\n    },\n    createHref: (href) =>\n      `${win.location.pathname}${win.location.search}#${href}`,\n  })\n}\n\nexport function createMemoryHistory(\n  opts: {\n    initialEntries: string[]\n    initialIndex?: number\n  } = {\n    initialEntries: ['/'],\n  },\n): RouterHistory {\n  const entries = opts.initialEntries\n  let index = opts.initialIndex ?? entries.length - 1\n  let currentState = {\n    key: createRandomKey(),\n  } as HistoryState\n\n  const getLocation = () => parseHref(entries[index]!, currentState)\n\n  return createHistory({\n    getLocation,\n    pushState: (path, state) => {\n      currentState = state\n      entries.push(path)\n      index++\n    },\n    replaceState: (path, state) => {\n      currentState = state\n      entries[index] = path\n    },\n    back: () => {\n      index--\n    },\n    forward: () => {\n      index = Math.min(index + 1, entries.length - 1)\n    },\n    go: (n) => {\n      index = Math.min(Math.max(index + n, 0), entries.length - 1)\n    },\n    createHref: (path) => path,\n  })\n}\n\nfunction parseHref(href: string, state: HistoryState): HistoryLocation {\n  let hashIndex = href.indexOf('#')\n  let searchIndex = href.indexOf('?')\n\n  return {\n    href,\n    pathname: href.substring(\n      0,\n      hashIndex > 0\n        ? searchIndex > 0\n          ? Math.min(hashIndex, searchIndex)\n          : hashIndex\n        : searchIndex > 0\n          ? searchIndex\n          : href.length,\n    ),\n    hash: hashIndex > -1 ? href.substring(hashIndex) : '',\n    search:\n      searchIndex > -1\n        ? href.slice(searchIndex, hashIndex === -1 ? undefined : hashIndex)\n        : '',\n    state: state || {},\n  }\n}\n\n// Thanks co-pilot!\nfunction createRandomKey() {\n  return (Math.random() + 1).toString(36).substring(7)\n}\n"],"names":["pushStateEvent","popStateEvent","beforeUnloadEvent","beforeUnloadListener","event","preventDefault","returnValue","stopBlocking","removeEventListener","capture","createHistory","opts","location","getLocation","subscribers","Set","blockers","onUpdate","forEach","subscriber","tryNavigation","task","document","length","blocker","allowed","onBlocked","subscribe","cb","add","delete","push","path","state","assignKey","pushState","replace","replaceState","go","index","back","forward","createHref","str","block","addEventListener","filter","b","flush","destroy","notify","key","createRandomKey","createBrowserHistory","win","window","undefined","parseLocation","parseHref","pathname","search","hash","history","currentLocation","rollbackLocation","next","tracking","scheduled","untrack","fn","isPush","href","queueHistoryAction","type","destHref","Promise","resolve","then","onPushPop","originalPushState","originalReplaceState","n","res","apply","arguments","createHashHistory","hashHref","split","slice","join","createMemoryHistory","initialEntries","entries","initialIndex","currentState","Math","min","max","hashIndex","indexOf","searchIndex","substring","random","toString"],"mappings":"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"}